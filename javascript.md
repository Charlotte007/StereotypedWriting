## ðŸ˜Š Javascriptæ˜¯é™æ€ä½œç”¨åŸŸ(è¯æ³•ä½œç”¨åŸŸ)ä¸ŽåŠ¨æ€ä½œç”¨åŸŸ?

Javascriptæ˜¯é™æ€ä½œç”¨åŸŸ, å‡½æ•°çš„ä½œç”¨åŸŸåœ¨å‡½æ•°å®šä¹‰çš„æ—¶å€™å°±ç¡®å®šäº†ã€‚åŠ¨æ€ä½œç”¨åŸŸæ˜¯åœ¨å‡½æ•°è°ƒç”¨çš„æ—¶å€™æ‰ç¡®ç«‹ã€‚

```js
var value = 1;

function foo() { console.log(value); }

function bar() { var value = 2; foo(); }

// å¦‚æžœæ˜¯é™æ€ä½œç”¨åŸŸï¼Œæ‰“å°1
// å¦‚æžœæ˜¯åŠ¨æ€ä½œç”¨åŸŸï¼Œæ‰“å°2
bar();
```

## ðŸ˜Š è¯´ä¸€è¯´æ‰§è¡Œä¸Šä¸‹æ–‡ 

æ´»åŠ¨çš„æ‰§è¡Œä¸Šä¸‹æ–‡ä¼šç»„æˆä¸€ä¸ªä¸Šä¸‹æ–‡å †æ ˆã€‚å †æ ˆçš„åº•éƒ¨æ˜¯å…¨å±€ä¸Šä¸‹æ–‡ï¼Œé¡¶éƒ¨å°±æ˜¯å½“å‰æ´»åŠ¨çš„æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚

è¿›å…¥å‡½æ•°æ—¶ä¸Šä¸‹æ–‡ï¼Œå‡½æ•°çš„ä¸Šä¸‹æ–‡è¢«æŽ¨å…¥å †æ ˆ(ä½†æ˜¯ä¸åŒ…å«å‡½æ•°ä¸­åµŒå¥—å‡½æ•°çš„ä¸Šä¸‹æ–‡)ã€‚å½“å‡½æ•°`return`æ—¶ï¼Œå‡½æ•°ä¸Šä¸‹æ–‡å¼¹å‡ºå †æ ˆã€‚å½“æ‰€æœ‰ä»£ç æ‰§è¡Œå®ŒæˆåŽï¼ŒECStackä¸­åªä¼šå­˜åœ¨ä¸€ä¸ªå…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚

### å˜é‡å¯¹è±¡(VO)/æ´»åŠ¨å¯¹è±¡(AO)

å˜é‡å¯¹è±¡VO, æ˜¯ä¸€ä¸ªä¸Žæ‰§è¡Œä¸Šä¸‹æ–‡ç›¸å…³çš„ç‰¹æ®Šå±žæ€§ï¼Œå®ƒå­˜å‚¨ç€ä¸Šä¸‹æ–‡ä¸­ä»¥ä¸‹å†…å®¹ï¼š**å˜é‡**, **å‡½æ•°çš„å£°æ˜Žï¼ˆä¸åŒ…å«å‡½æ•°è¡¨è¾¾å¼ï¼Œä½†æ˜¯åŒ…å«ä¿å­˜å‡½æ•°è¡¨è¾¾å¼çš„å˜é‡ï¼‰**, **å‡½æ•°çš„å½¢å‚**ï¼Œå®ƒä»¬ä½œä¸ºVOå¯¹è±¡çš„å±žæ€§ã€‚

å…¨å±€å¯¹è±¡æ˜¯åœ¨è¿›å…¥ä»»ä½•ä¸Šä¸‹æ–‡ä¹‹å‰å°±å·²ç»åˆ›å»ºçš„å¯¹è±¡ï¼Œå…¨å±€å¯¹è±¡åªå­˜åœ¨ä¸€ä»½ã€‚å…¨å±€å¯¹è±¡åœ¨åˆ›å»ºé˜¶æ®µï¼Œä¼šå°†`Math`ã€`String`ã€`Date`ã€`parseInt`ä½œä¸ºè‡ªèº«å±žæ€§è¿›è¡Œåˆå§‹åŒ–ã€‚å…¶ä»–çš„å…¨å±€å˜é‡ä¹Ÿä¼šå½“ä½œå…¨å±€å¯¹è±¡çš„å±žæ€§ã€‚å…¨å±€ä¸Šä¸‹æ–‡çš„VOï¼Œå°±æ˜¯å…¨å±€å¯¹è±¡è‡ªå·± ï¼ˆ`globalContext.VO === global`ï¼‰
#### å‡½æ•°ä¸Šä¸‹æ–‡çš„å˜é‡å¯¹è±¡

å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­VOæ— æ³•ç›´æŽ¥è®¿é—®ã€‚åœ¨å‡½æ•°çš„æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨æ´»åŠ¨å¯¹è±¡AOæ›¿ä»£å˜é‡å¯¹è±¡VOçš„åŠŸèƒ½ã€‚AOæ˜¯åœ¨è¿›å…¥å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡æ—¶è¢«åˆ›å»ºçš„ã€‚
#### å¤„ç†ä¸Šä¸‹æ–‡ä¹‹ä¸­ä»£ç çš„ä¸¤ä¸ªé˜¶æ®µ
##### é˜¶æ®µ1ï¼šè¿›å…¥æ‰§è¡Œä¸Šä¸‹æ–‡

åœ¨ä»£ç è¿›å…¥æ‰§è¡Œä¸Šä¸‹æ–‡æ—¶ï¼Œè¿˜æ²¡æœ‰å¼€å§‹æ‰§è¡Œæ—¶ï¼ŒVO/AOå°±å·²ç»åŒ…å«äº†ä¸‹é¢çš„å±žæ€§

- å½¢å‚, å½¢å‚ä¼šä½œä¸ºAOå¯¹è±¡çš„å±žæ€§ï¼Œå¦‚æžœä¼ å‚äº†å±žæ€§ä¼šè¢«èµ‹å€¼ï¼Œå¦åˆ™æ˜¯undefinedã€‚
- å‡½æ•°å£°æ˜Žï¼Œå‡½æ•°åå’Œå‡½æ•°çš„å†…å®¹ä½œä¸ºå˜é‡å¯¹è±¡çš„keyå’Œvalueï¼ˆå‡½æ•°å£°æ˜Žçš„ä¼˜å…ˆçº§ä¼šé«˜äºŽå˜é‡å£°æ˜Žï¼Œå¦‚æžœå˜é‡å£°æ˜Žä¸Žå‡½æ•°å£°æ˜Žæœ‰ç›¸åŒå±žæ€§ï¼Œå‡½æ•°å£°æ˜Žä¼šæ›¿ä»£å˜é‡å£°æ˜Žï¼Œå‡½æ•°å£°æ˜Žåœ¨è¿›å…¥ä¸Šä¸‹æ–‡çš„é˜¶æ®µå°±ä¼šè¢«èµ‹å€¼, æ‰€ä»¥åœ¨å‡½æ•°å£°æ˜Žå‰è°ƒç”¨å®ƒä¸ä¼šæŠ¥é”™ï¼Œåœ¨ä»£ç æ‰§è¡Œé˜¶æ®µå‡½æ•°å£°æ˜Žä¸ä¼šé‡å¤çš„èµ‹å€¼ï¼‰
- å˜é‡å£°æ˜Žï¼Œå˜é‡çš„å£°æ˜Žä¼˜å…ˆçº§åœ¨å½¢å‚å’Œå‡½æ•°å£°æ˜Žä¹‹åŽã€‚

##### é˜¶æ®µ2ï¼šæ‰§è¡Œä¸Šä¸‹æ–‡ä¸­çš„ä»£ç 

æŽ¥ä¸‹æ¥è¿›å…¥ä»£ç æ‰§è¡Œé˜¶æ®µï¼Œæ­¤æ—¶AO/VOå¯¹è±¡éƒ½å·²ç»æœ‰äº†å±žæ€§ï¼Œå¹¶ä¸”å±žæ€§å€¼è¿˜æ˜¯undefinedï¼Œä»£ç æ‰§è¡Œé˜¶æ®µVOå±žæ€§ä¼šè¢«æ›´æ–°èµ‹å€¼ã€‚

ä¸ºä»€ä¹ˆjsä¸­å˜é‡çš„é»˜è®¤å€¼æ˜¯undefinedçš„ï¼Ÿå› ä¸ºåœ¨è¿›å…¥æ‰§è¡Œä¸Šä¸‹æ–‡çš„é˜¶æ®µï¼ŒVO/AOå¯¹è±¡çš„å±žæ€§å€¼å°±è¢«èµ‹äºˆäº†undefinedï¼Œæ‰€ä»¥jså˜é‡å€¼é»˜è®¤æ˜¯è¢«èµ‹äºˆäº†undefinedï¼Œè€Œä¸æ˜¯å¤©ç”Ÿå°±æ˜¯undefinedã€‚

å³ä½¿æ°¸è¿œèµ°ä¸åˆ°çš„åˆ†æ”¯ä»£ç ï¼Œä¹Ÿä¼šèµ‹å€¼ä¸ºundefinedï¼Œè¿™æ˜¯å› ä¸ºåœ¨è¿›å…¥æ‰§è¡Œä¸Šä¸‹æ–‡çš„é˜¶æ®µæ”¾å…¥VOä¸­è¢«èµ‹å€¼ä¸ºundefinedã€‚

## ðŸ˜Š è¯´ä¸€è¯´ä½œç”¨åŸŸ

åœ¨JSä¸­å…è®¸åµŒå¥—å‡½æ•°ï¼Œæ¯ä¸€ä¸ªå‡½æ•°éƒ½æœ‰è‡ªèº«çš„å˜é‡å¯¹è±¡VOï¼Œç”±äºŽå‡½æ•°æ— æ³•ç›´æŽ¥è®¿é—®VOï¼Œå¯¹äºŽå‡½æ•°æ¥è¯´å°±æ˜¯AOæ´»åŠ¨å¯¹è±¡ã€‚è€Œä½œç”¨åŸŸé“¾åˆ™æ˜¯AOçš„åˆ—è¡¨ã€‚ä½œç”¨åŸŸé“¾ä½œç”¨æ˜¯ç”¨äºŽå˜é‡çš„æŸ¥è¯¢ã€‚å‡½æ•°çš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œåœ¨å‡½æ•°è°ƒç”¨æ—¶åˆ›å»ºã€‚åŒ…å«äº†VO/AOå±žæ€§ï¼Œä»¥åŠ[[scope]]å±žæ€§ã€‚è€Œä½œç”¨åŸŸé“¾Scopeå±žæ€§ï¼Œç­‰äºŽVO + `[[scope]]`å±žæ€§

### [[scope]]å±žæ€§

`[[scope]]`æ˜¯å½“å‰æ‰§è¡Œä¸Šä¸‹æ–‡çš„å±žæ€§ï¼Œ`[[scope]]`å±žæ€§åŒ…å«æ‰€æœ‰çˆ¶å˜é‡å¯¹è±¡ï¼ˆVOï¼‰çš„å±‚çº§é“¾ã€‚`[[scope]]`åœ¨å‡½æ•°åˆ›å»ºæ—¶è¢«åˆ›å»ºå¹¶å­˜å‚¨ï¼Œä¸å¯å˜ã€‚ç›´åˆ°å‡½æ•°è¢«é”€æ¯ï¼Œä¹Ÿå°±æ˜¯è¯´ä½œç”¨åŸŸé“¾åœ¨å®šä¹‰å‡½æ•°æ—¶å°±å·²ç»ç¡®å®šçš„ï¼Œå³ä½¿å‡½æ•°ä¸è¢«è°ƒç”¨ï¼Œå®ƒçš„çš„`[[scope]]`å±žæ€§ä¹Ÿå·²ç»è¢«å†™å…¥äº†ã€‚
### å‡½æ•°æ¿€æ´»

è¿›å…¥ä¸Šä¸‹æ–‡ï¼Œåˆ›å»ºAO/VOå¯¹è±¡åŽï¼ŒAO/VOå¯¹è±¡ä¼šæ·»åŠ Scopeå±žæ€§çš„ç¬¬ä¸€ä½ï¼Œè¿™å¯¹äºŽæ ‡ç¤ºç¬¦è§£æžå¾ˆé‡è¦ï¼Œå› ä¸ºå˜é‡åçš„æŸ¥æ‰¾æ˜¯ä»Žæœ€æ·±å¤„å¼€å§‹çš„ï¼Œç”±äºŽå½“å‰çš„AO/VOå¯¹è±¡ä¼šæ”¾åˆ°ç¬¬ä¸€ä½ï¼Œæ‰€ä»¥å±€éƒ¨çš„å˜é‡ä¼˜å…ˆçº§åœ¨æŸ¥æ‰¾æ—¶ä¼šé«˜äºŽçˆ¶ä½œç”¨åŸŸçš„å˜é‡ã€‚
Scopeå±žæ€§ = [å½“å‰æ‰§è¡Œä¸Šä¸‹æ–‡çš„AO/VO, [[scope]]]ã€‚
### ä¿®æ”¹ä½œç”¨åŸŸé“¾

withå’Œcatchä¼šä¿®æ”¹ä½œç”¨åŸŸé“¾ï¼Œè¢«ä¿®æ”¹çš„ä½œç”¨åŸŸé“¾ `Scope = [withçš„å‚æ•°, AO|VO, [[Scope]]]`ã€‚

## ðŸ˜Š è¯´ä¸€è¯´é—­åŒ…

> MDNå¯¹é—­åŒ…çš„å®šä¹‰ä¸ºï¼š**é—­åŒ…æ˜¯æŒ‡é‚£äº›èƒ½å¤Ÿè®¿é—®è‡ªç”±å˜é‡çš„å‡½æ•°ã€‚**

> é‚£ä»€ä¹ˆæ˜¯è‡ªç”±å˜é‡å‘¢ï¼Ÿè‡ªç”±å˜é‡æ˜¯æŒ‡åœ¨å‡½æ•°ä¸­ä½¿ç”¨çš„ï¼Œä½†æ—¢ä¸æ˜¯å‡½æ•°å‚æ•°ä¹Ÿä¸æ˜¯å‡½æ•°çš„å±€éƒ¨å˜é‡çš„å˜é‡ã€‚

> ç”±æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºé—­åŒ…å…±æœ‰ä¸¤éƒ¨åˆ†ç»„æˆï¼šé—­åŒ… = å‡½æ•° + å‡½æ•°èƒ½å¤Ÿè®¿é—®çš„è‡ªç”±å˜é‡

**é—­åŒ…æ˜¯ä»£ç å—å’Œåˆ›å»ºè¯¥ä»£ç å—çš„ä¸Šä¸‹æ–‡ä¸­æ•°æ®çš„ç»“åˆã€‚**å‡½æ•°çš„çˆ¶çº§ä¸Šä¸‹æ–‡æ•°æ®ä¿å­˜åœ¨å‡½æ•°çš„å†…éƒ¨å±žæ€§`[[scope]]`ä¸­ï¼Œç”±äºŽjsæ˜¯ä½¿ç”¨é™æ€è¯æ³•ä½œç”¨åŸŸçš„è¯­è¨€ï¼ŒåŒ…å«äº†çˆ¶çº§ä¸Šä¸‹æ–‡çš„æ•°æ®çš„`[[scope]]`å±žæ€§ï¼Œåœ¨å‡½æ•°åˆ›å»ºæ—¶å°±å·²ç»ä¿å­˜äº†ï¼Œä¸ç®¡å‡½æ•°æœ‰æ²¡æœ‰è°ƒç”¨ã€‚å› ä¸ºä½œç”¨åŸŸé“¾ï¼Œåœ¨jsä¸­æ‰€æœ‰å‡½æ•°éƒ½æ˜¯é—­åŒ…ï¼Œå› ä¸ºå®ƒä»¬åœ¨åˆ›å»ºçš„æ—¶å€™ï¼Œéƒ½ä¿å­˜äº†ä¸Šå±‚ä¸Šä¸‹æ–‡çš„ä½œç”¨åŸŸé“¾ã€‚åœ¨åŒä¸€ä¸ªä¸Šä¸‹æ–‡ä¸­åˆ›å»ºçš„é—­åŒ…ï¼Œå…±ç”¨ä¸€ä¸ª`[[scope]]`å±žæ€§ï¼Œå¯¹`[[scope]]`çš„ä¿®æ”¹ï¼Œä¼šå½±å“åˆ°å…¶ä»–é—­åŒ…ã€‚ä¹Ÿå°±æ˜¯è¯´åŒä¸€ä¸ªä¸Šä¸‹æ–‡åˆ›å»ºçš„é—­åŒ…ï¼Œå…±äº«åŒä¸€ä¸ªçˆ¶ä½œç”¨åŸŸã€‚

## ðŸ˜Š è¯´ä¸€è¯´äº‹ä»¶å¾ªçŽ¯

### ä»€ä¹ˆæ˜¯äº‹ä»¶å¾ªçŽ¯ï¼Ÿ

JSçš„æ‰§è¡Œï¼Œæµè§ˆå™¨çš„æ¸²æŸ“ï¼ŒDOMå­˜å‚¨éƒ½åœ¨**ä¸»çº¿ç¨‹**ä¸Šè¿›è¡Œã€‚æµè§ˆå™¨ä¼šè¡ç”Ÿå‡ºä¸€äº›å…¶ä»–çº¿ç¨‹ç”¨æ¥å¤„ç†ç½‘ç»œè¯·æ±‚ï¼Œç›‘æŽ§è¾“å…¥è®¾å¤‡ç­‰ã€‚ä¸€æ—¦è¡ç”Ÿçº¿ç¨‹ï¼Œéœ€è¦é¡µé¢å“åº”ï¼Œå®ƒä»¬ä¼šé€šçŸ¥ä¸»çº¿ç¨‹ï¼Œè¿™å°±æ˜¯**äº‹ä»¶å¾ªçŽ¯**åšçš„äº‹æƒ…ã€‚**ç›‘å¬è¡ç”Ÿçº¿ç¨‹ï¼Œå¹¶é€šçŸ¥ä¸»çº¿ç¨‹**ã€‚

### ä»»åŠ¡é˜Ÿåˆ—

å¯¹äºŽ`setTimeout`, `setTimeout`ä¼šå‘ä»»åŠ¡é˜Ÿåˆ—ä¸­æ·»åŠ ä»»åŠ¡ã€‚ä»»åŠ¡é˜Ÿåˆ—åœ¨ä¸»çº¿ç¨‹ä¹‹å¤–ï¼Œå¹¶è¡Œç­‰å¾…ï¼Œç­‰å¾…å®ŒæˆåŽï¼Œä¼šå›žåˆ°ä¸»çº¿ç¨‹å½“ä¸­ã€‚å½“ä»»åŠ¡å›žåˆ°ä¸»çº¿ç¨‹åŽï¼Œä¸»çº¿ç¨‹ä¼šåŽ»æ‰§è¡Œæ·»åŠ çš„ä»»åŠ¡ã€‚
### æµè§ˆå™¨æ¸²æŸ“

æµè§ˆå™¨æ¸²æŸ“çš„è¿‡ç¨‹åŒ…å«äº†CSSæ ·å¼è®¡ç®—, æž„å»ºæ¸²æŸ“æ ‘, è®¡ç®—å…ƒç´ çš„ä½ç½®åƒç´ , ç„¶åŽç»˜åˆ¶ã€‚æµè§ˆå™¨æ¸²æŸ“å’Œæ‰§è¡Œä»»åŠ¡åˆ†åˆ«**ä¸»çº¿ç¨‹çš„ä¸¤ç«¯**ã€‚
ä¸»çº¿ç¨‹å¿…é¡»æ‰§è¡Œä»»åŠ¡åŽæ‰ä¼šè¿›è¡Œæµè§ˆå™¨æ¸²æŸ“çš„æ“ä½œã€‚ä½†æ˜¯é‡åˆ°äº†`while(true)`, ç›¸å½“äºŽé‡åˆ°äº†ä¸€ä¸ªæ°¸è¿œæ— æ³•æ‰§è¡Œå®Œæˆçš„ä»»åŠ¡ï¼Œæ‰€ä»¥æµè§ˆå™¨æ°¸è¿œä¸ä¼šè¿›è¡Œæ¸²æŸ“æ“ä½œï¼Œå¯¼è‡´æµè§ˆå™¨å¡æ­»ã€‚ä¸»çº¿ç¨‹çš„å·¥ä½œæµç¨‹å¯ä»¥ç®€å•æ¦‚æ‹¬ä¸ºï¼Œ`æ‰§è¡Œä»»åŠ¡ --> æµè§ˆå™¨æ¸²æŸ“ --> æ‰§è¡Œä»»åŠ¡ --> æµè§ˆå™¨æ¸²æŸ“`ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ**æ‰§è¡Œä»»åŠ¡åŽï¼Œæµè§ˆå™¨æ˜¯ä¸èƒ½ä¿è¯ä¸€å®šä¼šé‡æ–°æ¸²æŸ“çš„ï¼Œå¯èƒ½æˆ‘ä»¬å¤šæ¬¡æ‰§è¡Œä»»åŠ¡ä¹‹åŽï¼Œæµè§ˆå™¨æ‰ä¼šæ¸²æŸ“ä¸€æ¬¡**ã€‚

### requestAnimationFrame

requestAnimationFrameåªä¼šåœ¨æµè§ˆå™¨æ¸²æŸ“å‰æ‰§è¡Œï¼Œå’Œå®ä»»åŠ¡ï¼Œå¾®ä»»åŠ¡æ— å…³ã€‚

### å¾®ä»»åŠ¡

å¾®ä»»åŠ¡åˆ°åº•ä¼šåœ¨ä»€ä¹ˆæ—¶å€™æ‰§è¡Œï¼Œä¼šåœ¨å®ä»»åŠ¡ç»“æŸåŽæ‰§è¡Œå—ï¼Ÿè¿™ç§è¯´æ³•åªèƒ½è¯´éƒ¨åˆ†æ­£ç¡®ã€‚æ­£ç¡®çš„è¯´æ³•åº”è¯¥æ˜¯å®ä»»åŠ¡å †æ ˆä¸ºç©ºæ—¶æ‰§è¡Œã€‚
### äº‹ä»¶å¾ªçŽ¯çš„æ•´ä½“é¡ºåº

1. æ‰§è¡Œå®ä»»åŠ¡
2. å®ä»»åŠ¡æ‰§è¡Œæ ˆä¸ºç©ºï¼ŒæŸ¥è¯¢æ˜¯å¦æœ‰å¾®ä»»åŠ¡éœ€è¦æ‰§è¡Œ
3. æ¸…ç©ºå¾®ä»»åŠ¡æ ˆ
4. å¯èƒ½ä¼šæ‰§è¡ŒrequestAnimationFrameï¼Œç„¶åŽæ¸²æŸ“æµè§ˆå™¨
5. ä¸‹ä¸€è½®äº‹ä»¶å¾ªçŽ¯
### äº‹ä»¶å¾ªçŽ¯çš„é¢˜ç›®

```js
// 1, 2, 3, 4, 5, 6
setTimeout(() => {
  console.log(1)
  new Promise((resolve, reject) => {
    console.log(2)
    resolve()
  }).then(() => {
    console.log(3)
  })
}, 0)

setTimeout(() => {
  new Promise((resolve) => {
    resolve()
  }).then(() => {
    console.log(4)
    new Promise((resolve) => {
      resolve()
    }).then(() => {
      console.log(5)
    })
  }).then(() => {
    console.log(6)
  })
}, 0)
```

## ðŸ˜Š è¯´ä¸€è¯´åŽŸåž‹é“¾
## ðŸ˜Š è¯´ä¸€è¯´ç»§æ‰¿
### ES5ç»§æ‰¿å®žçŽ°

![es5.png](https://i.loli.net/2021/04/12/iaXDQAPbq93sLl6.png)

```js
/**
 * å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿
 */

// çˆ¶ç±»
function Father(name) {
  this.name = name
}
Father.prototype.sayName = function() {
  console.log(this.name)
}

// å­ç±»
function Son(name, age) {
  Father.call(this, name)
  this.age = age
}

// ä¿®æ­£åŽŸåž‹é“¾
Son.prototype = Object.create(Father.prototype)
Son.prototype.constructor = Son

Son.prototype.sayAge = function() {
  console.log(this)
}
```
### ES6ç»§æ‰¿å®žçŽ°

![es6ç»§æ‰¿.png](https://i.loli.net/2021/04/12/2CO5HRe4bda9GzK.png)

```js
class Father {
  constructor(name) { this.name = name }
  sayName() {
	  console.log(this.name)
  }
}

class Son extends Father {
  constructor(name, age) {
	  super(name)
	  this.age = age
  }
  sayAge(age) {
	  console.log(this.age)
  }
}
```
### ES5ç»§æ‰¿å’ŒES6ç»§æ‰¿æœ‰ä»€ä¹ˆåŒºåˆ«?

- `ES5`æ˜¯å…ˆåˆ›å»ºå­ç±»å®žä¾‹å¯¹è±¡çš„`this`ï¼Œç„¶åŽå†å°†çˆ¶ç±»çš„æ–¹æ³•æ·»åŠ åˆ°`this`ä¸Šé¢ï¼ˆ`Parent.apply(this)`ï¼‰ã€‚
- `ES6`çš„ç»§æ‰¿æœºåˆ¶å®Œå…¨ä¸åŒï¼Œå®žè´¨æ˜¯å…ˆå°†çˆ¶ç±»å®žä¾‹å¯¹è±¡çš„å±žæ€§å’Œæ–¹æ³•ï¼ŒåŠ åˆ°`this`ä¸Šé¢ï¼ˆæ‰€ä»¥å¿…é¡»å…ˆè°ƒç”¨`super`æ–¹æ³•ï¼‰ï¼Œç„¶åŽå†ç”¨å­ç±»çš„æž„é€ å‡½æ•°ä¿®æ”¹`this`æŒ‡å‘ã€‚
- ES6ç»§æ‰¿ä¸­å­ç±»çš„`__proto__`æŒ‡å‘çˆ¶ç±»ã€‚ES5ç»§æ‰¿ä¸­æ²¡æœ‰ã€‚
## è¯´ä¸€è¯´this

## typeof

## instanceof

## ç§»åŠ¨ç«¯çš„å¸ƒå±€

## generateråŽŸç†

## asyncå’ŒawiatåŽŸç†

## mapå’Œobjectçš„åŒºåˆ«

## WeakSetä¸ŽSetçš„åŒºåˆ«


## WeakMapä¸ŽMapçš„åŒºåˆ«

## ðŸ˜Š window.onloadå’ŒDOMContentLoadedçš„åŒºåˆ«

## ðŸ˜Š targetå’ŒcurrentTargetåŒºåˆ«

- event.targetï¼Œè¿”å›žè§¦å‘äº‹ä»¶çš„å…ƒç´ ï¼Œå¯èƒ½ä¸æ˜¯ç»‘å®šäº‹ä»¶çš„å…ƒç´ 
- event.currentTargetï¼Œè¿”å›žç»‘å®šäº‹ä»¶çš„å…ƒç´ 
## ðŸ˜Š letï¼Œconstï¼Œvarçš„åŒºåˆ«

- `var`å˜é‡çš„ä½œç”¨åŸŸæ˜¯å®ƒå½“å‰çš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œ`var`ä¼šä½¿å˜é‡æå‡ï¼Œè¿™æ„å‘³ç€å˜é‡å¯ä»¥åœ¨å£°æ˜Žä¹‹å‰ä½¿ç”¨ã€‚`var`ä¼šç›´æŽ¥åœ¨æ ˆå†…å­˜é¢„åˆ†é…å†…å­˜ç©ºé—´ï¼Œå®žé™…ä»£ç æ‰§è¡Œçš„æ—¶å€™å†è¿›è¡Œå˜é‡å­˜å‚¨ï¼Œå¦‚æžœä¼ å…¥çš„æ˜¯åº”å¼•ç”¨æ•°æ®ç±»åž‹ï¼Œåˆ™ä¼šåœ¨å †å†…å­˜ä¸­å¼€è¾Ÿä¸€ä¸ªå†…å­˜ç©ºé—´å­˜å‚¨æ•°æ®ï¼Œæ ˆå†…å­˜å­˜å‚¨çš„æ˜¯æ•°æ®çš„å¼•ç”¨ï¼ŒæŒ‡å‘å †å†…å­˜åœ°å€ã€‚
- `let`å˜é‡çš„ä½œç”¨åŸŸæ˜¯å—çº§ä½œç”¨åŸŸï¼Œå­˜åœ¨æš‚å­˜æ€§æ­»åŒºï¼Œ`let`ä¸ä¼šä½¿å˜é‡æå‡ã€‚`let`åˆ™ä¸ä¼šé¢„åˆ†é…å†…å­˜ç©ºé—´ï¼Œè€Œä¸”åœ¨æ ˆå†…å­˜åˆ†é…å˜é‡æ—¶ï¼Œåšä¸€ä¸ªæ£€æŸ¥ï¼Œå¦‚æžœå·²ç»æœ‰ç›¸åŒå˜é‡åå­˜åœ¨å°±ä¼šæŠ¥é”™ã€‚
- `const`å˜é‡çš„ä½œç”¨åŸŸæ˜¯å—çº§ä½œç”¨åŸŸï¼Œå­˜åœ¨æš‚å­˜æ€§æ­»åŒºï¼Œ`const`ä¸ä¼šä½¿å˜é‡æå‡ã€‚`const`ä¸Ž`let`çš„å†…å®¹åˆ†é…ä¸€è‡´ã€‚

## ðŸ˜Š cookieï¼ŒlocalStorageï¼ŒsessionStorageåŒºåˆ«


## ðŸ˜Š å¤šä¸ªé¡µé¢ä¹‹é—´å¦‚ä½•è¿›è¡Œé€šä¿¡

## ðŸ˜Š bind, call, applyçš„åŒºåˆ«
## ðŸ˜Š ä¸€äº›è¾“å‡ºç»“æžœçš„JSé¢è¯•é¢˜
### é¢˜ç›®ä¸€

è¯´å‡º`['1', '2', '3'].map(parseInt)`çš„æ‰§è¡Œç»“æžœ

parseInt(è§£æžçš„å€¼, è§£æžå€¼çš„è¿›åˆ¶) ç„¶åŽè¿”å›ž10è¿›åˆ¶æ•°

```js
parseInt('123', 5) // å°†'123'çœ‹ä½œ5è¿›åˆ¶æ•°è¿›è¡Œè§£æžï¼Œè¿”å›ž38
parseInt('2', 2) // '2', ä¸èƒ½è½¬æ¢ä¸º2è¿›åˆ¶æ‰€ä»¥è¿”å›žNaN
parseInt('12', 2) // 1, 1å¯ä»¥è½¬æ¢ä¸º2è¿›åˆ¶è¿”å›ž1ï¼Œ'2', ä¸èƒ½è½¬æ¢ä¸º2è¿›åˆ¶æ‰€ä»¥å¿½ç•¥

// é¢˜ç›®è§£ç­”å¦‚ä¸‹
parseInt('1', 0) // 1
parseInt('2', 1) // NaN
parseInt('3', 2) // NaN
```

### é¢˜ç›®äºŒ

è¯´å‡ºä¸‹é¢ä»£ç çš„æ‰§è¡Œç»“æžœ

```js
var b = 10;
(function b() {
  b = 20;
  console.log(b);
})();
```


### é¢˜ç›®ä¸‰

è¯´å‡ºä¸‹é¢ä»£ç çš„æ‰§è¡Œç»“æžœ

```js
var obj = {
  2: 3,
  3: 4,
  length: 2,
  splice: Array.prototype.splice,
  push: Array.prototype.push,
};
obj.push(1);
obj.push(2);
console.log(obj);
```

### é¢˜ç›®å››

è¯´å‡ºä¸‹é¢ä»£ç çš„æ‰§è¡Œç»“æžœ

```js
function Foo() {
  Foo.a = function () {
    console.log(1);
  };
  this.a = function () {
    console.log(2);
  };
}
Foo.prototype.a = function () {
  console.log(3);
};
Foo.a = function () {
  console.log(4);
};
Foo.a();
let obj = new Foo();
obj.a();
Foo.a();
```

### é¢˜ç›®äº”

è¯´å‡ºä¸‹é¢ä»£ç çš„æ‰§è¡Œç»“æžœ

```js
String("11") == new String("11");
String("11") === new String("11");
```

### é¢˜ç›®å…­

è¯´å‡ºä¸‹é¢ä»£ç çš„æ‰§è¡Œç»“æžœ

```js
function A() {
  this.name = "Tom";
  this.color = ["green", "yellow"];
}
function B() {}
B.prototype = new A();
var b1 = new B();
var b2 = new B();
b1.name = "Lily";
b1.color.push("black");
console.log(b1.name);
console.log(b2.name);
console.log(b1.color);
console.log(b2.color);
```

### é¢˜ç›®ä¸ƒ (äº‹ä»¶å¾ªçŽ¯)

```js
console.log(1)

document.body.addEventListener('click', () => {
  console.log(2)
})

Promise.resolve().then(() => {
  console.log(3)
})

setTimeout(() => {
  console.log(4)
}, 0)

console.log(5)

document.body.click()

console.log(6)


1, 5, 2, 6, 3, 4
```
