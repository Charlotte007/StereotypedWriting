## é”™è¯¯ç›‘æ§SDK
### â›°ï¸sdkçš„ä¸€äº›å…¨å±€é…ç½®

bidæ˜¯é¡¹ç›®çš„idï¼Œuidå¯ä»¥æ˜¯ç”¨æˆ·çš„idï¼ˆä¹Ÿå¯ä»¥ä¸è®¾ç½®ï¼‰ï¼Œuuidæ¯ä¸€æ¬¡ä¸ŠæŠ¥éšæœºå‚ç”Ÿçš„

```ts
bid?: string; // å¹³å°åˆ†é…çš„åº”ç”¨å”¯ä¸€æ ‡è¯†ï¼Œåœ¨åˆ›å»ºåº”ç”¨æ—¶è‡ªåŠ¨åˆ†é…çš„ åº”ç”¨æ ‡è¯† å­—æ®µ
rel?: string; // å‰ç«¯ç‰ˆæœ¬å·
uid?: string; // æµè§ˆå½“å‰é¡µé¢çš„ç”¨æˆ·å”¯ä¸€æ ‡è¯†ï¼Œæ¨èè®¾ç½®
sampleRate?: number; // é‡‡æ ·ç‡
silentDev?: boolean; // æ˜¯å¦åœ¨å¼€å‘ç¯å¢ƒä¸‹ä¸å‘é€
// ç­‰ç­‰
```
### â›°ï¸ å¯¹äºå¼€å‘ç¯å¢ƒçš„åˆ¤æ–­

åˆ¤æ–­urlä¸Šæ˜¯å¦æœ‰`local`, `dev`, `localhost`, `0.0.0.0`, `127.0.0.1` å¦‚æœæœ‰ä¸è¿›è¡Œä¸ŠæŠ¥

```ts
const allowedHosts: Array<string> = ['local', 'dev', 'localhost', '0.0.0.0', '127.0.0.1'];

export const isDev =
  !!allowedHosts.find(item => hostname.indexOf(item) > -1) || /^http:\/\/(\d{1,3}\.){3}\d{1,3}/.test(origin);
```
### â›°ï¸ å¯¹äºé”™è¯¯çš„å¤„ç†
#### â›°ï¸ RunTimeError

`window.addEventListener('error', this.handleError, false);` ç›‘å¬è¿è¡Œæ—¶jsçš„é”™è¯¯ã€‚é”™è¯¯ä¸ŠæŠ¥çš„å›è°ƒæ·»åŠ åˆ°queueé˜Ÿåˆ—ä¸­ã€‚ã€‚`addEventListener`çš„ç¬¬ä¸‰ä¸ªå‚æ•°è®¾ç½®ä¸ºfalseï¼Œé”™è¯¯éœ€è¦åœ¨å†’æ³¡é˜¶æ®µæ•è·ã€‚jsèµ„æºé”™è¯¯çš„ä¸ä¼šå†’æ³¡çš„ã€‚

è¿è¡Œæ—¶é”™è¯¯çš„æ•°æ®æ ¼å¼

```js
// eventæ˜¯é”™è¯¯ç›‘å¬äº‹ä»¶çš„event

// æ ¼å¼åŒ–é”™è¯¯ä¿¡æ¯
const matchResult = event.message.match(ERROR_TYPES_RE);
const name = matchResult ? matchResult[1] || 'Error' : 'Error';
const message = matchResult ? matchResult[2] || 'unknown message' : event.message;

const params = {
  type: 'jsError',
  w_name: name, // é”™è¯¯çš„åç§°
  w_msg: message, // é”™è¯¯çš„message
  w_file: event.filename, // å‡ºé”™çš„æ–‡ä»¶å
  w_line: event.lineno, // è¡Œ
  w_col: event.colno, // åˆ—
  stack: event.error && event.error.stack // å †æ ˆğŸ™
};
```

#### â›°ï¸ UnhandledRejectionError

`window.removeEventListener('unhandledrejection', this.handleError, false);` ç›‘å¬å¼‚æ­¥çš„é”™è¯¯ã€‚é”™è¯¯ä¸ŠæŠ¥çš„å›è°ƒæ·»åŠ åˆ°queueé˜Ÿåˆ—ä¸­ã€‚ã€‚ç”±äºæ—¶å¼‚æ­¥é”™è¯¯ï¼Œæ‰€ä»¥æ˜¯æ²¡æœ‰è¡Œï¼Œåˆ—ä¿¡æ¯çš„ã€‚

å¼‚å¸¸é”™è¯¯çš„æ•°æ®æ ¼å¼:

```js
const params = {
  type: 'jsError', // é”™è¯¯çš„ç±»å‹
  w_name: 'unhandledrejection', // ç»Ÿä¸€çš„w_name
  w_msg: reason instanceof Error ? reason.message : reason,
  stack: reason?.stack // å †æ ˆä¿¡æ¯
};
```
#### â›°ï¸ ResourceError

`window.removeEventListener('error', this.handleError, true);`, ç›‘å¬èµ„æºåŠ è½½é”™è¯¯ã€‚å› ä¸ºscriptçš„erroræ˜¯ä¸ä¼šå†’æ³¡çš„ã€‚é”™è¯¯ä¸ŠæŠ¥çš„å›è°ƒæ·»åŠ åˆ°queueé˜Ÿåˆ—ä¸­ã€‚

ResourceErrorä¸­ä¼šåˆ¤æ–­targetï¼Œå¦‚æœtargetä¸æ˜¯HTMLScriptElementï¼Œæˆ–è€…HTMLLinkElementï¼Œæˆ–è€…HTMLImageElementåˆ™ä¸åšå¤„ç†ã€‚é¿å…å’ŒRunTimeErroré‡å¤ä¸ŠæŠ¥ã€‚

èµ„æºåŠ è½½å¼‚å¸¸çš„æ ¼å¼:

```js
const _target = {
  outerHTML: target.outerHTML, // æ ‡ç­¾çš„å†…å®¹, åŒ…æ‹¬æ ‡ç­¾
  src, // æ ‡ç­¾çš„src
  tagName
  id: target.id,
  className: target.className,
  XPath: Array.isArray((event as any).path) ? getXPathByPath((event as any).path) : getXPath
  (target) // è·å–æ•è·è¿‡ç¨‹ä¸­çš„æ‰€æœ‰ç»è¿‡çš„å…ƒç´ ï¼Œå¦‚æœä¸æ”¯æŒpathï¼Œåˆ™å‘ä¸Šé€’å½’æŸ¥æ‰¾ï¼Œç›´åˆ°ä¸ºnull
};
```

### â›°ï¸ å¯¹äºæ€§èƒ½çš„å¤„ç†

- domainLookupStart åŸŸåå¼€å§‹è§£ææ—¶çš„æ—¶é—´æˆ³
- domainLookupEnd åŸŸåç»“æŸç»“æŸæ—¶çš„æ—¶é—´æˆ³
- responseEnd æµè§ˆå™¨ä»æœåŠ¡å™¨ã€ç¼“å­˜æˆ–è€…æœ¬åœ°èµ„æºæ¥æ”¶å“åº”çš„æœ€åä¸€ä¸ªå­—èŠ‚æˆ–è€…è¿æ¥è¢«å…³é—­ä¹‹æ—¶çš„ Unixæ¯«ç§’æ—¶é—´æˆ³ã€‚
- domInteractiveï¼ŒDocument.readyState æ”¹å˜ä¸º'interactive'ï¼ˆå¯äº¤äº’çš„çŠ¶æ€ï¼‰çš„æ—¶é—´æˆ³
- fetchStart æµè§ˆå™¨å·²ç»å‡†å¤‡å¥½å»ä½¿ç”¨HTTPè¯·æ±‚æŠ“å–æ–‡æ¡£ä¹‹æ—¶æ—¶é—´æˆ³
- loadEventStart loadäº‹ä»¶è¢«è§¦å‘ä¹‹æ—¶çš„æ—¶é—´æˆ³
- loadEventEnd loadäº‹ä»¶ç»“æŸçš„æ—¶é—´æˆ³

```ts
// Performance.timing åªè¯»å±æ€§è¿”å›ä¸€ä¸ª PerformanceTiming å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡åŒ…æ‹¬äº†é¡µé¢ç›¸å…³çš„æ€§èƒ½ä¿¡æ¯ã€‚
let t = performance.timing;
// dnsæŸ¥è¯¢çš„æ—¶é—´
times.w_dns = t.domainLookupEnd - t.domainLookupStart;
// tcpè¿æ¥çš„æ—¶é—´
times.w_tcp = t.connectEnd - t.connectStart;
// domè§£æçš„äº‹é•¿
times.w_domparsing = t.domInteractive - t.responseEnd
// é¡µé¢å¯äº¤äº’çš„æ—¶é—´
times.w_tti = t.domInteractive - t.fetchStart
// é¡µé¢å®Œå…¨åŠ è½½çš„æ—¶é•¿
times.w_load = t.loadEventStart - t.fetchStart
```

```ts
// register æ˜¯è·å–æ€§èƒ½æ•°æ®çš„å‡½æ•°
// å¦‚æœé¡µé¢ä»¥åŠåŠ è½½å®Œæˆï¼Œåˆ™ç«‹åˆ»è·å–æ€§èƒ½æ•°æ®ï¼Œå¦‚æœæ²¡æœ‰åˆ™åœ¨loadäº‹ä»¶ç»“æŸåè·å–
if (document.readyState !== 'complete') {
  // NOTE: passive å¿½ç•¥ preventDefault()
  window.addEventListener('load', () => setTimeout(register, 0), { passive: true });
} else {
  register();
}
```

è·å–æ€§èƒ½æ•°æ®åï¼Œæ€§èƒ½æ•°æ®ä¹Ÿä¼šè¢«pushåˆ°Queueä¸­
### å¯¹äºé”™è¯¯ä¸ŠæŠ¥çš„å¤„ç†
#### â›°ï¸ reporter

é”™è¯¯ä¸ŠæŠ¥ä½¿ç”¨xhræˆ–è€…`window.navigator.sendBeacon`ï¼Œå¦‚æœé¡µé¢æ˜¯https, å¹¶ä¸”æ”¯æŒ`window.navigator.sendBeacon`å°±ä½¿ç”¨sendBeaconä¸ŠæŠ¥é”™è¯¯ã€‚å¦‚æœæ˜¯xhråˆ™æ˜¯postè¯·æ±‚ã€‚

xhræœ‰å¯èƒ½å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯åœ¨å…³é—­æµè§ˆå™¨çš„æ—¶å€™ï¼Œå¦‚æœå‘é€ajaxå¼‚æ­¥è¯·æ±‚ï¼Œajaxå¼‚æ­¥è¯·æ±‚æœ‰å¯èƒ½ä¼šä¸­æ­¢ã€‚navigator.sendBeaconï¼Œç”¨äºè§£å†³æ–‡æ¡£å¸è½½æ—¶å‘æœåŠ¡å™¨å‘é€æ•°æ®çš„é—®é¢˜ã€‚æ•°æ®å¼‚æ­¥ä¼ è¾“ï¼Œä¸å½±å“ä¸‹ä¸€é¡µçš„åŠ è½½æ€§èƒ½ã€‚æ•°æ®è¢«å¯é åœ°å‘é€ã€‚

ä½†æ˜¯ä¸ä¼šnavigator.sendBeaconä¸ä¼šè¿”å›æ•°æ®å‘é€æ˜¯å¦æˆåŠŸçš„ä¿¡æ¯ã€‚
#### Queue

é”™è¯¯ä¿¡æ¯éƒ½ä¼šè¢«pushåˆ°Queueé˜Ÿåˆ—ä¹‹ä¸­
#### ä¸ºä»€ä¹ˆåœ¨visibilitychangeäº‹ä»¶ä¸­å‘é€ä¿¡æ¯ï¼Ÿ

> ç§»åŠ¨ç«¯è®¾å¤‡ä½¿ç”¨`visibilitychange`ï¼Œä½†æ˜¯safariä¸å…¼å®¹ä½¿ç”¨beforeunloadæ—¶é—´



### å¯¹äºæ¥å£è¯·æ±‚é€Ÿåº¦çš„ç›‘å¬

é‡å†™äº†åŸç”Ÿxhrå¯¹è±¡ä¸Šçš„openå’Œsendæ–¹æ³•, sendæ–¹æ³•è®°å½•å½“å‰çš„æ—¶é—´æˆ³ï¼Œopenæ–¹æ³•è®°å½•äº†è¯·æ±‚æ–¹å¼ï¼Œè¯·æ±‚urlï¼Œç¨åä½¿ç”¨ã€‚

ä¼šåœ¨è¯·æ±‚å®Œæˆæ—¶ï¼Œé”™è¯¯æ—¶ï¼Œè¶…æ—¶æ—¶ï¼Œä¸ŠæŠ¥è¯·æ±‚çš„è€—æ—¶

```js
window.XMLHttpRequest.prototype.open = function(...args: any[]) {
  // ä¿å­˜ method ä¸ url åç»­ä¼šç”¨åˆ°
  (this as any)._method = args[0];
  (this as any)._url = args[1];

  // @ts-ignore
  self.oldAjaxOpenMethod.call(this, ...args);
};

window.XMLHttpRequest.prototype.send = function(body) {
  const startTime = getTimestamp();
  if (this['addEventListener']) {
    this.addEventListener('timeout', event => _handleEvent(event as any, body, startTime));
    this.addEventListener('error', event => _handleEvent(event as any, body, startTime));
    this.addEventListener('load', event => _handleEvent(event as any, body, startTime));
    this.addEventListener('abort', event => _handleEvent(event as any, body, startTime));
  }

  self.oldAjaxSendMethod.call(this, body);
};
```

### æ¥å£é”™è¯¯

æä¾›Apiï¼Œé¡¹ç›®æ–¹æ‰‹åŠ¨ä¸ŠæŠ¥

## PCç«™

## ç»„ä»¶åº“çš„å¼€å‘

### ç»„ä»¶åº“çš„æ‰“åŒ…é…ç½®

### ç»„ä»¶åº“æŒ‰éœ€å¼•å…¥çš„åŸç†
### Modal

### Alert
### Tabs

## reactåŠ¨ç”»ç»„ä»¶
