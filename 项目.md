## â›°ï¸ é”™è¯¯ç›‘æ§SDK

### â›°ï¸ shouldReport

æ˜¯å¦è¿‡æ»¤ä¸ŠæŠ¥çš„é”™è¯¯ï¼Œåœ¨å°†é”™è¯¯pushåˆ°Queueä¹‹å‰ä¼šæœ‰ä¸€ä¸ªå‡½æ•°ï¼Œå¯ä»¥è‡ªå®šä¹‰è¿‡æ»¤é”™è¯¯ã€‚
### â›°ï¸ sendBeaconçš„å¤§å°é™åˆ¶

sendBeaconçš„å¤§å°é™åˆ¶å–å†³ä¸æµè§ˆå™¨çš„ã€‚
### â›°ï¸ ç”¨æˆ·è¡Œä¸ºçš„è®°å½•ä»¥åŠä¸ŠæŠ¥ï¼ˆæ“ä½œè·¯å¾„ï¼‰

å°†ç‚¹å‡»å…ƒç´ çš„ä¿¡æ¯pushåˆ°recordsï¼Œrecordsæœ€å¤§é•¿åº¦é™åˆ¶æ˜¯20ï¼Œå¦‚æœè¶…å‡º20ï¼Œå°±ç§»é™¤ç¬¬ä¸€ä¸ªã€‚ä½†æ˜¯ååºæ²¡æœ‰å¯¹recordsé˜Ÿåˆ—åšå¤„ç†ã€‚

```js
class ClickPlugin implements RigPlugin {
  install() {
    window.addEventListener(
      'click',
      event => {
        const { outerHTML = '', tagName = '', className = '' }: any = event.target || {};
        if (['HTML', 'BODY'].includes(tagName)) {
          return;
        }
        records.push(getListOption('click', { outerHTML, tagName, className }));
      },
      true
    );
  }
  uninstall() {}
}
```
### â›°ï¸sdkçš„ä¸€äº›å…¨å±€é…ç½®

bidæ˜¯é¡¹ç›®çš„idï¼Œuidå¯ä»¥æ˜¯ç”¨æˆ·çš„idï¼ˆä¹Ÿå¯ä»¥ä¸è®¾ç½®ï¼‰ï¼Œuuidæ¯ä¸€æ¬¡ä¸ŠæŠ¥éšæœºå‚ç”Ÿçš„

```ts
bid?: string; // å¹³å°åˆ†é…çš„åº”ç”¨å”¯ä¸€æ ‡è¯†ï¼Œåœ¨åˆ›å»ºåº”ç”¨æ—¶è‡ªåŠ¨åˆ†é…çš„ åº”ç”¨æ ‡è¯† å­—æ®µ
rel?: string; // å‰ç«¯ç‰ˆæœ¬å·
uid?: string; // æµè§ˆå½“å‰é¡µé¢çš„ç”¨æˆ·å”¯ä¸€æ ‡è¯†ï¼Œæ¨èè®¾ç½®
sampleRate?: number; // é‡‡æ ·ç‡
silentDev?: boolean; // æ˜¯å¦åœ¨å¼€å‘ç¯å¢ƒä¸‹ä¸å‘é€
// ç­‰ç­‰
```
### â›°ï¸ å¯¹äºå¼€å‘ç¯å¢ƒçš„åˆ¤æ–­

åˆ¤æ–­urlä¸Šæ˜¯å¦æœ‰`local`, `dev`, `localhost`, `0.0.0.0`, `127.0.0.1` å¦‚æœæœ‰ä¸è¿›è¡Œä¸ŠæŠ¥

```ts
const allowedHosts: Array<string> = ['local', 'dev', 'localhost', '0.0.0.0', '127.0.0.1'];

export const isDev =
  !!allowedHosts.find(item => hostname.indexOf(item) > -1) || /^http:\/\/(\d{1,3}\.){3}\d{1,3}/.test(origin);
```
### â›°ï¸ å¯¹äºé”™è¯¯çš„å¤„ç†
#### â›°ï¸ RunTimeError

`window.addEventListener('error', this.handleError, false);` ç›‘å¬è¿è¡Œæ—¶jsçš„é”™è¯¯ã€‚é”™è¯¯ä¸ŠæŠ¥çš„å›è°ƒæ·»åŠ åˆ°queueé˜Ÿåˆ—ä¸­ã€‚ã€‚`addEventListener`çš„ç¬¬ä¸‰ä¸ªå‚æ•°è®¾ç½®ä¸ºfalseï¼Œé”™è¯¯éœ€è¦åœ¨å†’æ³¡é˜¶æ®µæ•è·ã€‚jsèµ„æºé”™è¯¯çš„ä¸ä¼šå†’æ³¡çš„ã€‚

è¿è¡Œæ—¶é”™è¯¯çš„æ•°æ®æ ¼å¼

```js
// eventæ˜¯é”™è¯¯ç›‘å¬äº‹ä»¶çš„event

// æ ¼å¼åŒ–é”™è¯¯ä¿¡æ¯
const matchResult = event.message.match(ERROR_TYPES_RE);
const name = matchResult ? matchResult[1] || 'Error' : 'Error';
const message = matchResult ? matchResult[2] || 'unknown message' : event.message;

const params = {
  type: 'jsError',
  w_name: name, // é”™è¯¯çš„åç§°
  w_msg: message, // é”™è¯¯çš„message
  w_file: event.filename, // å‡ºé”™çš„æ–‡ä»¶å
  w_line: event.lineno, // è¡Œ
  w_col: event.colno, // åˆ—
  stack: event.error && event.error.stack // å †æ ˆğŸ™
};
```
#### â›°ï¸ UnhandledRejectionError

`window.removeEventListener('unhandledrejection', this.handleError, false);` ç›‘å¬å¼‚æ­¥çš„é”™è¯¯ã€‚é”™è¯¯ä¸ŠæŠ¥çš„å›è°ƒæ·»åŠ åˆ°queueé˜Ÿåˆ—ä¸­ã€‚ã€‚ç”±äºæ—¶å¼‚æ­¥é”™è¯¯ï¼Œæ‰€ä»¥æ˜¯æ²¡æœ‰è¡Œï¼Œåˆ—ä¿¡æ¯çš„ã€‚

å¼‚å¸¸é”™è¯¯çš„æ•°æ®æ ¼å¼:

```js
const params = {
  type: 'jsError', // é”™è¯¯çš„ç±»å‹
  w_name: 'unhandledrejection', // ç»Ÿä¸€çš„w_name
  w_msg: reason instanceof Error ? reason.message : reason,
  stack: reason?.stack // å †æ ˆä¿¡æ¯
};
```
#### â›°ï¸ ResourceError

`window.removeEventListener('error', this.handleError, true);`, ç›‘å¬èµ„æºåŠ è½½é”™è¯¯ã€‚å› ä¸ºscriptçš„erroræ˜¯ä¸ä¼šå†’æ³¡çš„ã€‚é”™è¯¯ä¸ŠæŠ¥çš„å›è°ƒæ·»åŠ åˆ°queueé˜Ÿåˆ—ä¸­ã€‚

ResourceErrorä¸­ä¼šåˆ¤æ–­targetï¼Œå¦‚æœtargetä¸æ˜¯HTMLScriptElementï¼Œæˆ–è€…HTMLLinkElementï¼Œæˆ–è€…HTMLImageElementåˆ™ä¸åšå¤„ç†ã€‚é¿å…å’ŒRunTimeErroré‡å¤ä¸ŠæŠ¥ã€‚

èµ„æºåŠ è½½å¼‚å¸¸çš„æ ¼å¼:

```js
const _target = {
  outerHTML: target.outerHTML, // æ ‡ç­¾çš„å†…å®¹, åŒ…æ‹¬æ ‡ç­¾
  src, // æ ‡ç­¾çš„src
  tagName
  id: target.id,
  className: target.className,
  XPath: Array.isArray((event as any).path) ? getXPathByPath((event as any).path) : getXPath
  (target) // è·å–æ•è·è¿‡ç¨‹ä¸­çš„æ‰€æœ‰ç»è¿‡çš„å…ƒç´ ï¼Œå¦‚æœä¸æ”¯æŒpathï¼Œåˆ™å‘ä¸Šé€’å½’æŸ¥æ‰¾ï¼Œç›´åˆ°ä¸ºnull
};
```
### â›°ï¸ å¯¹äºæ€§èƒ½çš„å¤„ç†

- domainLookupStart åŸŸåå¼€å§‹è§£ææ—¶çš„æ—¶é—´æˆ³
- domainLookupEnd åŸŸåç»“æŸç»“æŸæ—¶çš„æ—¶é—´æˆ³
- responseEnd æµè§ˆå™¨ä»æœåŠ¡å™¨ã€ç¼“å­˜æˆ–è€…æœ¬åœ°èµ„æºæ¥æ”¶å“åº”çš„æœ€åä¸€ä¸ªå­—èŠ‚æˆ–è€…è¿æ¥è¢«å…³é—­ä¹‹æ—¶çš„ Unixæ¯«ç§’æ—¶é—´æˆ³ã€‚
- domInteractiveï¼ŒDocument.readyState æ”¹å˜ä¸º'interactive'ï¼ˆå¯äº¤äº’çš„çŠ¶æ€ï¼‰çš„æ—¶é—´æˆ³
- fetchStart æµè§ˆå™¨å·²ç»å‡†å¤‡å¥½å»ä½¿ç”¨HTTPè¯·æ±‚æŠ“å–æ–‡æ¡£ä¹‹æ—¶æ—¶é—´æˆ³
- loadEventStart loadäº‹ä»¶è¢«è§¦å‘ä¹‹æ—¶çš„æ—¶é—´æˆ³
- loadEventEnd loadäº‹ä»¶ç»“æŸçš„æ—¶é—´æˆ³

```ts
// Performance.timing åªè¯»å±æ€§è¿”å›ä¸€ä¸ª PerformanceTiming å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡åŒ…æ‹¬äº†é¡µé¢ç›¸å…³çš„æ€§èƒ½ä¿¡æ¯ã€‚
let t = performance.timing;
// dnsæŸ¥è¯¢çš„æ—¶é—´
times.w_dns = t.domainLookupEnd - t.domainLookupStart;
// tcpè¿æ¥çš„æ—¶é—´
times.w_tcp = t.connectEnd - t.connectStart;
// domè§£æçš„äº‹é•¿
times.w_domparsing = t.domInteractive - t.responseEnd
// é¡µé¢å¯äº¤äº’çš„æ—¶é—´
times.w_tti = t.domInteractive - t.fetchStart
// é¡µé¢å®Œå…¨åŠ è½½çš„æ—¶é•¿
times.w_load = t.loadEventStart - t.fetchStart
```

```ts
// register æ˜¯è·å–æ€§èƒ½æ•°æ®çš„å‡½æ•°
// å¦‚æœé¡µé¢ä»¥åŠåŠ è½½å®Œæˆï¼Œåˆ™ç«‹åˆ»è·å–æ€§èƒ½æ•°æ®ï¼Œå¦‚æœæ²¡æœ‰åˆ™åœ¨loadäº‹ä»¶ç»“æŸåè·å–
if (document.readyState !== 'complete') {
  // NOTE: passive å¿½ç•¥ preventDefault()
  window.addEventListener('load', () => setTimeout(register, 0), { passive: true });
} else {
  register();
}
```

è·å–æ€§èƒ½æ•°æ®åï¼Œæ€§èƒ½æ•°æ®ä¹Ÿä¼šè¢«pushåˆ°Queueä¸­
### â›°ï¸ å¯¹äºæ¥å£è¯·æ±‚é€Ÿåº¦çš„ç›‘å¬

é‡å†™äº†åŸç”Ÿxhrå¯¹è±¡ä¸Šçš„openå’Œsendæ–¹æ³•, sendæ–¹æ³•è®°å½•å½“å‰çš„æ—¶é—´æˆ³ï¼Œopenæ–¹æ³•è®°å½•äº†è¯·æ±‚æ–¹å¼ï¼Œè¯·æ±‚urlï¼Œç¨åä½¿ç”¨ã€‚

ä¼šåœ¨è¯·æ±‚å®Œæˆæ—¶ï¼Œé”™è¯¯æ—¶ï¼Œè¶…æ—¶æ—¶ï¼Œå°†æ¥å£è¯·æ±‚çš„æ•°æ®ï¼Œpushåˆ°Queueä¸­

```js
window.XMLHttpRequest.prototype.open = function(...args: any[]) {
  // ä¿å­˜ method ä¸ url åç»­ä¼šç”¨åˆ°
  (this as any)._method = args[0];
  (this as any)._url = args[1];

  // @ts-ignore
  self.oldAjaxOpenMethod.call(this, ...args);
};

window.XMLHttpRequest.prototype.send = function(body) {
  const startTime = getTimestamp();
  if (this['addEventListener']) {
    this.addEventListener('timeout', event => _handleEvent(event as any, body, startTime));
    this.addEventListener('error', event => _handleEvent(event as any, body, startTime));
    this.addEventListener('load', event => _handleEvent(event as any, body, startTime));
    this.addEventListener('abort', event => _handleEvent(event as any, body, startTime));
  }

  self.oldAjaxSendMethod.call(this, body);
};
```
### â›°ï¸ æ‰‹åŠ¨ä¸ŠæŠ¥æ¥å£é”™è¯¯

å¦‚æœä¸šåŠ¡æ–¹æ‰‹åŠ¨catchäº†é”™è¯¯ï¼Œå¯ä»¥ä½¿ç”¨apiæ‰‹åŠ¨ä¸ŠæŠ¥

```js
public reportApiError = (params: {
  method: 'GET' | 'HEAD' | 'POST' | 'PUT' | 'DELETE' | 'CONNECT' | 'OPTIONS' | 'TRACE';
  url: string;
  requestBody?: string;
  timestamp?: number;
  status?: number;
  statusText?: string;
  responseBody?: string;
}): void => {
  const p = Object.assign(getBasicInfo(globalConfigs), params, { type: 'api', isAbnormal: true });
  queue.pushTask(() => reporter(p));
};
```
### â›°ï¸ å¯¹äºé”™è¯¯ä¸ŠæŠ¥çš„å¤„ç†
#### â›°ï¸ reporter

é”™è¯¯ä¸ŠæŠ¥ä½¿ç”¨xhræˆ–è€…`window.navigator.sendBeacon`ï¼Œå¦‚æœé¡µé¢æ˜¯https, å¹¶ä¸”æ”¯æŒ`window.navigator.sendBeacon`å°±ä½¿ç”¨sendBeaconä¸ŠæŠ¥é”™è¯¯ã€‚å¦‚æœæ˜¯xhråˆ™æ˜¯postè¯·æ±‚ã€‚

xhræœ‰å¯èƒ½å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯åœ¨å…³é—­æµè§ˆå™¨çš„æ—¶å€™ï¼Œå¦‚æœå‘é€ajaxå¼‚æ­¥è¯·æ±‚ï¼Œajaxå¼‚æ­¥è¯·æ±‚æœ‰å¯èƒ½ä¼šä¸­æ­¢ã€‚navigator.sendBeaconï¼Œç”¨äºè§£å†³æ–‡æ¡£å¸è½½æ—¶å‘æœåŠ¡å™¨å‘é€æ•°æ®çš„é—®é¢˜ã€‚æ•°æ®å¼‚æ­¥ä¼ è¾“ï¼Œä¸å½±å“ä¸‹ä¸€é¡µçš„åŠ è½½æ€§èƒ½ã€‚æ•°æ®è¢«å¯é åœ°å‘é€ã€‚

ä½†æ˜¯ä¸ä¼šnavigator.sendBeaconä¸ä¼šè¿”å›æ•°æ®å‘é€æ˜¯å¦æˆåŠŸçš„ä¿¡æ¯ã€‚
#### â›°ï¸ Queue

> ç§»åŠ¨ç«¯è®¾å¤‡ä½¿ç”¨`visibilitychange`ï¼Œä½†æ˜¯safariä¸å…¼å®¹ä½¿ç”¨beforeunloadæ—¶é—´

é”™è¯¯ä¿¡æ¯éƒ½ä¼šè¢«pushåˆ°Queueé˜Ÿåˆ—ä¹‹ä¸­ã€‚åœ¨`visibilitychange`äº‹ä»¶ï¼Œå’Œ`beforeunload`äº‹ä»¶ï¼ˆå…¼å®¹safariï¼‰ã€‚å¹¶ä¸”`document.visibilityState === 'hidden'`æ—¶å¤„ç†é˜Ÿåˆ—ã€‚

é˜Ÿåˆ—ä¸­çš„æ•°æ®æ ¼å¼æ˜¯ï¼š

```js
{
  state: {
    time: å½“å‰çš„æ—¶é—´æˆ³,
    visibilityState: document.visibilityStateçš„çŠ¶æ€
  },
  task, // éœ€è¦æ‰§è¡Œçš„ä¸ŠæŠ¥ä»»åŠ¡ï¼Œæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå°±æ˜¯æˆ‘ä»¬pushè¿›å»çš„
  minTaskTime: é»˜è®¤æ˜¯0
}
```

æ¯ä¸€æ¬¡pushåˆ°Queueä¹‹åï¼Œéƒ½ä¼šè¿›è¡Œå¤„ç†ä»»åŠ¡çš„æ“ä½œã€‚ä½†æ˜¯åˆ†ä¸¤ç§æƒ…å†µ

å¦‚æœå½“å‰`document.visibilityState`ç­‰äºhiddenï¼Œåˆ™åœ¨ä¸‹ä¸€æ¬¡å¾®ä»»åŠ¡ä¸­æ¸…ç©ºé˜Ÿåˆ—ã€‚å°±æ˜¯ä½¿ç”¨whileå¾ªç¯


å¦‚æœå½“å‰`document.visibilityState`ä¸ç­‰äºhiddenï¼Œåˆ™åœ¨æµè§ˆå™¨ç©ºé—²çš„æ—¶å€™æ¸…ç©ºé˜Ÿåˆ—ã€‚è¿™å¿«å°±ç›¸å¯¹æ¥è¯´æ¯”è¾ƒå¤æ‚ä¸€äº›ã€‚ä¼šè®°å½•å½“å‰çš„æ—¶é—´æˆ³ï¼Œç„¶ååœ¨ä¸‹æ¬¡å®ä»»åŠ¡ï¼ˆsetTimeout(() => , 0)ï¼‰å¼€å§‹å¤„ç†é˜Ÿåˆ—ï¼Œå¤„ç†ä¸€æ¬¡é˜Ÿåˆ—ï¼Œåˆ¤æ–­å½“å‰çš„ç”¨æ—¶æ˜¯å¦è¶…è¿‡äº†50msï¼ˆä¸ºæ¨¡æ‹ŸrequestIdleCallbackï¼‰ã€‚å¦‚æœè¶…è¿‡50msä¸å¤„ç†ï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡å¤„ç†ã€‚

å¦‚æœåœ¨50mså†…ï¼Œä»»åŠ¡æ²¡æœ‰å¤„ç†å®Œæˆã€‚ä¼šå¼€å¯ä¸‹ä¸€æ¬¡çš„ä»»åŠ¡è°ƒåº¦ã€‚
#### â›°ï¸ ä¸ºä»€ä¹ˆåœ¨visibilitychangeäº‹ä»¶ä¸­å‘é€ä¿¡æ¯ï¼Ÿ

ä¸ºäº†é¿å…ä¸»çº¿ç¨‹çš„é˜»å¡ã€‚

#### â›°ï¸ ä¸ºä»€ä¹ˆä¸ç”¨requestIdCallbackå‘¢ï¼Ÿ

å…¼å®¹æ€§æœ‰é—®é¢˜ï¼Œå¹¶ä¸”æ²¡æœ‰å«ç‰‡, åªèƒ½ä½¿ç”¨setTimeoutæ¨¡æ‹Ÿ

### â›°ï¸ sdkè‡ªèº«é”™è¯¯å¤„ç†å¤„ç†ï¼Ÿ

ä¼šå¯¹ä¸»è¦çš„é€»è¾‘éƒ½ä½¿ç”¨`try...catch`è¿›è¡ŒåŒ…è£¹ï¼Œå¦‚æœæœ‰é”™è¯¯å‘ç”Ÿç›®å‰åªä¼š`console.log`ã€‚

### ç™½å±å¦‚ä½•å¤„ç†
## ğŸš¢ ç¤¾åŒºPCç«™

ç¤¾åŒºPCç«™ï¼Œå¹¶æ²¡æœ‰ä½¿ç”¨é¦–å±SSRï¼Œä¹‹åæ˜¯CSRã€‚è€Œæ˜¯å…¨éƒ¨é‡‡ç”¨äº†SSRçš„æ–¹å¼ã€‚BBSè·¯ç”±ç®¡ç†ï¼Œå…¨éƒ¨èµ°çš„åç«¯å¤„ç†ï¼Œä¸å­˜åœ¨å‰ç«¯ç®¡ç†Routeã€‚æ‰€ä»¥é¦–å±çš„æ•°æ®éƒ½æ˜¯æœåŠ¡ç«¯ç«¯è·å–ï¼Œæ‰€ä»¥åªæœ‰æ³¨æ°´ï¼Œæ²¡æœ‰è„±æ°´ã€‚

å¤§æ¦‚çš„æµç¨‹ï¼Œå°±æ‹¿bbsçš„é¦–é¡µä¸ºä¾‹ï¼š

Beidouçš„Routeä¼šå¤„ç†è®¿é—®æœåŠ¡å™¨çš„url, äº¤ç”±å¯¹åº”çš„controllerçš„å¤„ç†

```ts
router.get('/', controller.bbs.bbsIndex);
```

åœ¨controllerä¸­ä¼šè¿›è¡Œè¯·æ±‚æ¥å£ï¼Œä»¥åŠç”¨æˆ·çš„user-agentè¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœæ˜¯IEæµè§ˆå™¨ï¼Œä¼šè¿›è¡Œé‡å®šå‘åˆ°è€ç‰ˆæœ¬ã€‚æ¥ç€å°±ä¼šè¯·æ±‚æ¥å£ï¼ˆåŒ…æ‹¬äº†èœå•æ•°æ®çš„æ¥å£, é¦–é¡µæ•°æ®çš„æ¥å£ï¼Œæˆ‘çš„å…³æ³¨æ¥å£ï¼Œä»¥åŠé€šè¿‡cookieåˆ¤æ–­æ˜¯å¦ç™»å½•isUï¼‰å¹¶å°†æ•°æ®è¿›è¡Œç»„è£…ã€‚ç„¶årenderå¯¹åº”çš„page, å¹¶æŠŠåœ¨controllerç»„è£…å¥½çš„æ•°æ®ä¼ é€’äº†è¿‡å»ã€‚ï¼ˆeggçš„ç‰¹æ€§ï¼Œé€šè¿‡æ–‡ä»¶çš„è·¯å¾„åˆ¤æ–­ï¼‰

```ts
public async bbsIndex() {
    const { ctx, service, app } = this;
    const cate = ctx.params && ctx.params[0]
    const menu = await service.common.menu();
    const response_menu = menu.response;
    const cookie = ctx.request.header.cookie

    //æ—§ç‰ˆIEåˆ¤æ–­
    const agent = useragent.parse(ctx.req.headers['user-agent']);
  
    let cateId = 0

    if (agent.family === 'IE') {
      if (cateId) {
        ctx.redirect(`/api/v1/dest?id=${cateId}&type=CATEGORY`);
      }
      return;
    }

    let getBBSIndex = null

    getBBSIndex = await service.bbs.getBBSIndex(cateId, cookie);
    let careListInfo = !cate ? await service.bbs.getcareList() : { response: [] }
    let isU = this.ctx.cookies.get('u', { signed: false })

    const response_getBBSIndex = getBBSIndex.response;
    const response_careListInfo = careListInfo.response;

    const vdata = {
      menu: response_menu && response_menu.data,
      env: app.env,
      isLogin: isU ? true : false,
      pageData: response_getBBSIndex && response_getBBSIndex.data,
      careListInfo: response_careListInfo && response_careListInfo.data && response_careListInfo.data.result.data
    };

    await ctx.render('pages/bbsIndex', {
      vdata: vdata,
    });
}
```

é™æ€æ–¹æ³•getPartialï¼Œè¿”å›éœ€è¦è¿›è¡Œå±€éƒ¨æ¸²æŸ“çš„Reactå®ä¾‹Mapå¯¹è±¡ï¼Œæ¸²æŸ“ç»“æœæœ€ç»ˆä¼šè¢«æ³¨å…¥åˆ°propsä¸­ï¼Œä¾› render æ–¹æ³•ä½¿ç”¨ã€‚

getPartial ä¸­è¿”å›çš„ { html: <BBSIndexModule vdata={vdata} />}ï¼ŒReact ç»„ä»¶ä¼šåœ¨æ¸²æŸ“ä¸­é—´ä»¶ä¸­ï¼Œé€šè¿‡ renderToString api æ¸²æŸ“ä¸ºå­—ç¬¦ä¸²ï¼Œå¹¶å°†ç»“æœåˆå¹¶åˆ° html ä¸­ã€‚

```ts
import "core-js";
import * as React from "react";
import * as ReactDOM from "react-dom";
import { ViewProps } from "beidou";
import "reset-css";
import "client/style/global.less";
import BBSIndexModule from "client/module/bbs.index";
import Page from "../page";
export default class View extends React.Component<ViewProps> {
  static getPartial(props: { vdata: any }) {
    const { vdata } = props;
    return {
      html: <BBSIndexModule vdata={vdata} />
    };
  }
  render() {
    const { html, helper, vdata } = this.props;
    const { env } = vdata;
    const links: string[] = ['manifest.css', 'bbsIndex.css']
    return (
      <Page
        helper={helper}
        links={links}
        html={html} // ä½¿ç”¨getPartialçš„è¿”å›
        vdata={vdata}
        scripts={scripts}
      />
    )
  }
}

if (__CLIENT__) {
  const vdata = window.$$data;
  ReactDOM.hydrate(
    <BBSIndexModule vdata={vdata} />,
    document.getElementById("container")
  );
}

```

__CLIENT__æ˜¯beidouå®šä¹‰çš„å…¨å±€å¯¹è±¡ï¼Œç”¨æ¥åˆ¤æ–­å½“å‰æ˜¯å¦æ˜¯æœåŠ¡ç«¯ç¯å¢ƒè¿˜æ˜¯å®¢æˆ·ç«¯ç¯å¢ƒã€‚å¦‚ä½•æ˜¯å®¢æˆ·ç«¯åˆ™è¿›è¡Œæ°´å’Œã€‚

BBSIndexModuleå†…éƒ¨å°±å’Œæ™®é€šçš„Reactç»„ä»¶ä¸€æ ·.

### é‡åˆ°é‚£äº›å›°éš¾ 

### æµå¼æ¸²æŸ“

ç›®å‰æ²¡æœ‰åœ¨é¡¹ç›®ä¸Šä½¿ç”¨åˆ°ï¼Œå…·ä½“çš„ç ”ç©¶è¯·çœ‹react.mdä¸Šçš„å†…å®¹
## ç»„ä»¶åº“çš„å¼€å‘

### ç»„ä»¶åº“çš„æ‰“åŒ…é…ç½®

- å¯¹äºéæŒ‰éœ€å¼•å…¥çš„jsæ–‡ä»¶ï¼Œç”±webpackæ‰“åŒ…ï¼Œæ‰“åŒ…åˆ°1ä¸ªjsæ–‡ä»¶ä¸­ã€‚
- å¯¹äºéæŒ‰éœ€å¼•å…¥çš„cssï¼Œä½¿ç”¨gulpæ‰“åŒ…ï¼Œæ‰“åŒ…åˆ°1ä¸ªcssæ–‡ä»¶ä¸­

- å¯¹äºæŒ‰éœ€å¼•å…¥çš„jsæ–‡ä»¶ï¼Œä½¿ç”¨gulpæ‰“åŒ…ï¼ŒæŒ‰ç…§srcç›®å½•çš„å±‚çº§æ‰“åŒ…
- å¯¹äºæŒ‰éœ€å¼•å…¥çš„cssæ–‡ä»¶ï¼Œä½¿ç”¨gulpæ‰“åŒ…ï¼Œä½†æ˜¯åªæ˜¯åšäº†æ‹·è´æ“ä½œ

webpackæ²¡æœ‰åŠæ³•æ‰“åŒ…esæ¨¡å—ï¼Œéœ€è¦ä½¿ç”¨gulp

### ç»„ä»¶åº“æŒ‰éœ€å¼•å…¥çš„åŸç†

ä½¿ç”¨babel-import-pluginï¼Œé…ç½®libraryDirectoryï¼Œæ‰“åŒ…çš„æ—¶å€™ï¼Œè‡ªåŠ¨ä¿®æ”¹importçš„pathã€‚

### å¯¹äºcssçš„å¤„ç†

cssï¼Œä½¿ç”¨lessï¼Œåœ¨å•ç‹¬çš„æ–‡ä»¶å†…ï¼Œåšç»Ÿä¸€çš„å¤„ç†

### æ»‘åŠ¨ç©¿é€çš„é—®é¢˜å¦‚ä½•è§£å†³ï¼Ÿ

åœ¨bodyä¸Šè®¾ç½®overflow: hiddenã€‚
### Modal




### Alert

### Tabs